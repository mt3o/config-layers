"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function u(c){return typeof c=="string"}function f(c){return c.split(new RegExp("(?<!\\.)\\.(?!\\.)"))}class d{layers;constructor(r){this.layers=r}notFoundHandler=r=>{throw new Error(`Key not found: ${String(r)}`)};static fromLayers(r,n){const s=new d(new Map(r.map(l=>[l.name,l.config])));return n?.notFoundHandler&&(s.notFoundHandler=n.notFoundHandler),new Proxy(()=>{},{apply(l,e,t){const[o,a]=t;return s.__withFallback(o,a)},has(l,e){const t=u(e)?f(e):[e];return t.length==1?s.__getFlat(e)!==void 0:t.length>1?s.__getComplex(e)!==void 0:!1},getOwnPropertyDescriptor(l,e){return{enumerable:!0,configurable:!0}},deleteProperty(l,e){return!1},set(){return!1},defineProperty(){return!1},ownKeys(){const e=Array.from(s.layers.values()).map(o=>Object.keys(o)),t=Array.from(new Set(e.flat()));return{...t,length:t.length}},get(l,e,t){if(e==="__inspect")return s.__inspect.bind(s);const o=u(e)?f(e):[e];if(o.length==1)return s.__getFlat(e);if(o.length>1)return s.__getComplex(e)}})}__withFallback(r,n){return(u(r)?f(r):[r]).length==1?this.__getFlat(r,n):this.__getComplex(r,n)}__getComplex(r,n){const s=u(r)?f(r):[r],l=Array.from(this.layers.values()).reverse();let e;for(const t of l){if(!t)continue;let o=t,a=!0;for(const i of s)if(o&&i in o)o=o[i];else{a=!1;break}if(a){e=o;break}}return e!==void 0?e:n||this.notFoundHandler(r)}__getFlat(r,n){for(const s of Array.from(this.layers.values()).reverse())if(s&&r in s)return s[r];return n||this.notFoundHandler(r)}__inspect(r){const n={key:r,resolved:{value:void 0,source:""},layers:[]},s=u(r)?f(r):[r],l=Array.from(this.layers.keys()).reverse();if(s.length<1)return{key:r,resolved:{value:void 0,source:""},layers:l.map(e=>({layer:e,value:void 0,isPresent:!1,isActive:!1}))};if(s.length==1){let e=!1;for(const t of l){const o=this.layers.get(t),a=!!(o&&r in o),i=a?o?.[r]:void 0,v=a?!e:!1;n.layers.push({layer:t,value:a?i:void 0,isPresent:a,isActive:v}),v&&!e&&(n.resolved.value=i,n.resolved.source=t,e=!0)}}if(s.length>1)for(const e of l){let t=this.layers.get(e);if(!t)continue;let o=!0;for(const i of s)if(t&&typeof t=="object"&&i in t)t=t[i];else{o=!1;break}o||(t=void 0);const a=o&&t!==void 0;n.layers.push({layer:e,value:a?t:void 0,isPresent:o,isActive:a&&n.resolved.value===void 0}),a&&n.resolved.value===void 0&&(n.resolved.value=t,n.resolved.source=e)}return n}}exports.LayeredConfig=d;
