(function(f,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(f=typeof globalThis<"u"?globalThis:f||self,a(f["Config Layers"]={}))})(this,(function(f){"use strict";function a(v){return typeof v=="string"}function c(v){return v.split(new RegExp("(?<!\\.)\\.(?!\\.)"))}class d{layers;constructor(r){this.layers=r}notFoundHandler=r=>{throw new Error(`Key not found: ${String(r)}`)};static fromLayers(r,n){const s=new d(new Map(r.map(i=>[i.name,i.config])));return n?.notFoundHandler&&(s.notFoundHandler=n.notFoundHandler),new Proxy(()=>{},{apply(i,e,t){const[o,l]=t;return s.__withFallback(o,l)},has(i,e){const t=a(e)?c(e):[e];return t.length==1?s.__getFlat(e)!==void 0:t.length>1?s.__getComplex(e)!==void 0:!1},getOwnPropertyDescriptor(i,e){return{enumerable:!0,configurable:!0}},deleteProperty(i,e){return!1},set(){return!1},defineProperty(){return!1},ownKeys(){const e=Array.from(s.layers.values()).map(o=>Object.keys(o)),t=Array.from(new Set(e.flat()));return{...t,length:t.length}},get(i,e,t){if(e==="__inspect")return s.__inspect.bind(s);const o=a(e)?c(e):[e];if(o.length==1)return s.__getFlat(e);if(o.length>1)return s.__getComplex(e)}})}__withFallback(r,n){return(a(r)?c(r):[r]).length==1?this.__getFlat(r,n):this.__getComplex(r,n)}__getComplex(r,n){const s=a(r)?c(r):[r],i=Array.from(this.layers.values()).reverse();let e;for(const t of i){if(!t)continue;let o=t,l=!0;for(const u of s)if(o&&u in o)o=o[u];else{l=!1;break}if(l){e=o;break}}return e!==void 0?e:n||this.notFoundHandler(r)}__getFlat(r,n){for(const s of Array.from(this.layers.values()).reverse())if(s&&r in s)return s[r];return n||this.notFoundHandler(r)}__inspect(r){const n={key:r,resolved:{value:void 0,source:""},layers:[]},s=a(r)?c(r):[r],i=Array.from(this.layers.keys()).reverse();if(s.length<1)return{key:r,resolved:{value:void 0,source:""},layers:i.map(e=>({layer:e,value:void 0,isPresent:!1,isActive:!1}))};if(s.length==1){let e=!1;for(const t of i){const o=this.layers.get(t),l=!!(o&&r in o),u=l?o?.[r]:void 0,p=l?!e:!1;n.layers.push({layer:t,value:l?u:void 0,isPresent:l,isActive:p}),p&&!e&&(n.resolved.value=u,n.resolved.source=t,e=!0)}}if(s.length>1)for(const e of i){let t=this.layers.get(e);if(!t)continue;let o=!0;for(const u of s)if(t&&typeof t=="object"&&u in t)t=t[u];else{o=!1;break}o||(t=void 0);const l=o&&t!==void 0;n.layers.push({layer:e,value:l?t:void 0,isPresent:o,isActive:l&&n.resolved.value===void 0}),l&&n.resolved.value===void 0&&(n.resolved.value=t,n.resolved.source=e)}return n}}f.LayeredConfig=d,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));
