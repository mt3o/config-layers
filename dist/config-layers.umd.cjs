(function(f,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(f=typeof globalThis<"u"?globalThis:f||self,a(f["Config Layers"]={}))})(this,(function(f){"use strict";function a(v){return typeof v=="string"}function c(v){return v.split(new RegExp("(?<!\\.)\\.(?!\\.)"))}class d{layers;constructor(t){this.layers=t}notFoundHandler=t=>{throw new Error(`Key not found: ${String(t)}`)};static fromLayers(t,s){const n=new d(new Map(t.map(i=>[i.name,i.config])));return s?.notFoundHandler&&(n.notFoundHandler=s.notFoundHandler),new Proxy(()=>{},{apply(i,e,r){const[o,l]=r;return n.__withFallback(o,l)},has(i,e){const r=a(e)?c(e):[e];return r.length==1?n.__getFlat(e)!==void 0:r.length>1?n.__getComplex(e)!==void 0:!1},getOwnPropertyDescriptor(i,e){return{enumerable:!0,configurable:!0}},deleteProperty(i,e){return!1},set(){return!1},defineProperty(){return!1},ownKeys(){const e=Array.from(n.layers.values()).map(o=>Object.keys(o)),r=Array.from(new Set(e.flat()));return{...r,length:r.length}},get(i,e,r){if(e==="__inspect")return n.__inspect.bind(n);if(e==="__derive")return n.__derive.bind(n);const o=a(e)?c(e):[e];if(o.length==1)return n.__getFlat(e);if(o.length>1)return n.__getComplex(e)}})}__withFallback(t,s){return(a(t)?c(t):[t]).length==1?this.__getFlat(t,s):this.__getComplex(t,s)}__derive(t,s,n){const i=Array.from(this.layers.entries()).reduce((e,[r,o])=>(e[r]=o,e),{});if(typeof t=="object"&&s===void 0){const e=Object.assign({},{notFoundHandler:this.notFoundHandler},t);return d.fromLayers(Object.entries(i).map(([r,o])=>({name:r,config:o})),e)}return typeof t=="string"&&s!==void 0?(i[t]=s,d.fromLayers(Object.entries(i).map(([e,r])=>({name:e,config:r})),Object.assign({},{notFoundHandler:this.notFoundHandler},n??{}))):d.fromLayers(Object.entries(i).map(([e,r])=>({name:e,config:r})),Object.assign({},{notFoundHandler:this.notFoundHandler},n??{}))}__getComplex(t,s){const n=a(t)?c(t):[t],i=Array.from(this.layers.values()).reverse();let e;for(const r of i){if(!r)continue;let o=r,l=!0;for(const u of n)if(o&&u in o)o=o[u];else{l=!1;break}if(l){e=o;break}}return e!==void 0?e:s||this.notFoundHandler(t)}__getFlat(t,s){for(const n of Array.from(this.layers.values()).reverse())if(n&&t in n)return n[t];return s||this.notFoundHandler(t)}__inspect(t){const s={key:t,resolved:{value:void 0,source:""},layers:[]},n=a(t)?c(t):[t],i=Array.from(this.layers.keys()).reverse();if(n.length<1)return{key:t,resolved:{value:void 0,source:""},layers:i.map(e=>({layer:e,value:void 0,isPresent:!1,isActive:!1}))};if(n.length==1){let e=!1;for(const r of i){const o=this.layers.get(r),l=!!(o&&t in o),u=l?o?.[t]:void 0,p=l?!e:!1;s.layers.push({layer:r,value:l?u:void 0,isPresent:l,isActive:p}),p&&!e&&(s.resolved.value=u,s.resolved.source=r,e=!0)}}if(n.length>1)for(const e of i){let r=this.layers.get(e);if(!r)continue;let o=!0;for(const u of n)if(r&&typeof r=="object"&&u in r)r=r[u];else{o=!1;break}o||(r=void 0);const l=o&&r!==void 0;s.layers.push({layer:e,value:l?r:void 0,isPresent:o,isActive:l&&s.resolved.value===void 0}),l&&s.resolved.value===void 0&&(s.resolved.value=r,s.resolved.source=e)}return s}}f.LayeredConfig=d,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));
